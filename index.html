<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formosa Tiers</title>
    
    <link rel="icon" href="icon.png?v=2" type="image/png">

    <style>
        :root {
            --bg-main: #0f1115;
            --bg-panel: #16181e;
            --bg-card: #20222b;
            --text-white: #eeeeee;
            --text-grey: #8b8e96;
            
            /* Tier Colors */
            --tier1-color: #d4af37;   /* é‡‘è‰² */
            --tier2-color: #a0a0a0;   /* éŠ€è‰² */
            --tier3-color: #cd7f32;   /* éŠ…è‰² */
            --tier4-color: #5b7da8;   /* è—è‰² */
            --tier5-color: #6e757c;   /* æ·±ç° */
        }

        body {
            background-color: var(--bg-main);
            color: var(--text-white);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            
            display: flex;
            flex-direction: column;
            align-items: center; 
        }

        /* --- é ‚éƒ¨ Header å€åŸŸ --- */
        .site-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 10px 0;
            border-bottom: 2px solid #2a2d35;
            
            width: 100%;
            max-width: 1260px; 
        }

        .logo-container {
            display: flex;
            align-items: center;
        }

        .site-logo {
            height: 60px;
            width: auto;
            object-fit: contain;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .discord-btn {
            background-color: #5865F2;
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
            font-size: 0.9rem;
            border: 1px solid transparent;
        }
        
        .discord-btn:hover {
            background-color: #4752C4;
        }

        .discord-btn svg {
            width: 20px;
            height: 20px;
            fill: white;
        }

        .top-search {
            background-color: #000;
            border: 1px solid #333;
            border-radius: 20px;
            padding: 8px 15px;
            color: #777;
            font-size: 0.9rem;
            width: 250px; 
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .top-search input {
            background: transparent;
            border: none;
            color: #eeeeee;
            font-size: 0.9rem;
            width: 100%;
            outline: none;
        }
        .top-search input::placeholder {
            color: #555;
        }

        /* --- å°èˆªåˆ— (Navbar) --- */
        .navbar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 0px;
            overflow-x: auto;
            white-space: nowrap;
            
            width: 100%;
            max-width: 1260px;
            justify-content: center;
        }

        .nav-item {
            padding: 10px 20px;
            color: var(--text-grey);
            cursor: pointer;
            font-weight: bold;
            font-size: 0.95rem;
            position: relative;
            transition: color 0.2s;
            user-select: none;
            background-color: #1a1c24;
            border-radius: 8px;
            margin-right: 5px;
        }
        
        .nav-item:hover {
            color: #ccc;
            background-color: #252830;
        }

        .nav-item.active {
            color: white;
            background-color: #3b82f6;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.4);
        }

        /* --- Tier ä½ˆå±€ --- */
        .tier-board {
            display: flex;
            flex-direction: row;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 20px;
            align-items: flex-start;
            
            width: 100%;
            max-width: 1260px;
            justify-content: center;
            min-height: 400px; /* é˜²æ­¢åŠ è¼‰æ™‚å¡Œé™· */
        }

        .tier-column {
            flex: 0 0 240px;
            width: 240px;
            display: flex;
            flex-direction: column;
        }

        .tier-header {
            padding: 12px;
            text-align: center;
            font-weight: 800;
            font-size: 1.1rem;
            border-top-left-radius: 6px;
            border-top-right-radius: 6px;
            background-color: #1e2028;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        /* é¡è‰²å®šç¾© */
        .t1-header { color: var(--tier1-color); border-top: 3px solid var(--tier1-color); background: linear-gradient(to bottom, #2d2a1e, #1e2028); }
        .t2-header { color: var(--tier2-color); border-top: 3px solid var(--tier2-color); }
        .t3-header { color: var(--tier3-color); border-top: 3px solid var(--tier3-color); }
        .t4-header { color: var(--tier4-color); border-top: 3px solid var(--tier4-color); }
        .t5-header { color: var(--tier5-color); border-top: 3px solid var(--tier5-color); }

        .player-list {
            background-color: var(--bg-panel);
            border-bottom-left-radius: 6px;
            border-bottom-right-radius: 6px;
            padding: 5px;
            min-height: 200px;
        }

        .player-card {
            background-color: var(--bg-card);
            margin-bottom: 4px;
            padding: 6px 10px;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 3px;
            cursor: pointer;
            transition: background 0.2s;
            position: relative;
            overflow: hidden;
        }

        .player-card:hover { background-color: #2a2d38; }

        .player-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
        }
        
        .t1-card::before { background-color: var(--tier1-color); }
        .t2-card::before { background-color: var(--tier2-color); }
        .t3-card::before { background-color: var(--tier3-color); }
        .t4-card::before { background-color: var(--tier4-color); }
        .t5-card::before { background-color: var(--tier5-color); }

        .arrow-icon { color: #444; font-size: 12px; }
        
        .no-data, .loading-data {
            width: 100%;
            text-align: center;
            color: #555;
            margin-top: 50px;
            font-size: 1.5rem;
        }
        
        /* ç°¡å–®çš„åŠ è¼‰å‹•ç•« */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #555;
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <header class="site-header">
        <div class="logo-container">
            <img src="logo.png" class="site-logo" alt="Formosa Tiers Logo">
        </div>
        
        <div class="header-controls">
            <a href="https://discord.gg/yctefdXTvy" target="_blank" class="discord-btn" title="Join our Discord">
                <svg viewBox="0 0 24 24">
                    <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037 13.924 13.924 0 0 0-.623 1.282 18.445 18.445 0 0 0-5.46 0 14.155 14.155 0 0 0-.623-1.282.072.072 0 0 0-.078-.037 19.742 19.742 0 0 0-4.886 1.515.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-2.313-9.117-6.046-13.687a.066.066 0 0 0-.03-.027ZM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.419 0 1.334-.956 2.419-2.157 2.419Zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.419 0 1.334-.946 2.419-2.157 2.419Z"/>
                </svg>
                <span>Discord</span>
            </a>

            <div class="top-search">
                <input type="text" id="searchInput" placeholder="Search player..." onkeyup="filterPlayers()">
                <span>ğŸ”</span>
            </div>
        </div>
    </header>

    <div class="navbar">
        <div class="nav-item active" onclick="switchTab(this, 'Sword')">ğŸ—¡ï¸ é‘½çŸ³ç‹ç‰Œ</div>
        <div class="nav-item" onclick="switchTab(this, 'UHC')">â¤ï¸ UHC</div>
        <div class="nav-item" onclick="switchTab(this, 'Pot')">ğŸ§ª é‘½çŸ³POT</div>
        <div class="nav-item" onclick="switchTab(this, 'NethOP')">ğŸ‘¾ ç„é«“POT</div>
        <div class="nav-item" onclick="switchTab(this, 'SMP')">ğŸŒ SMP</div>
        <div class="nav-item" onclick="switchTab(this, 'Mace')">ğŸ”¨ é‡æ¶</div>
        <div class="nav-item" onclick="switchTab(this, 'Axe')">ğŸª“ ç›¾æ–§</div>
        <div class="nav-item" onclick="switchTab(this, 'Vanilla')">ğŸ’ æ°´æ™¶</div>
    </div>

    <div class="tier-board" id="tierBoard">
        </div>

    <script>
        // --- è¨­å®šå€ ---
        const spreadsheetId = '1pRSRy8WOP5EJ7dng58QWZhuH90l4B0nFWqWI6rGoAyo'; 
        // ä¸éœ€è¦ sheetName äº†ï¼Œå› ç‚ºæœƒæ ¹æ“šæŒ‰éˆ•å‹•æ…‹æŠ“å–
        // --------------

        let database = {}; // æ ¼å¼: { "Sword": { "Tier 1": [], ... }, "UHC": ... }
        let currentMode = '';

        // Tier Emoji è¨­å®š
        const tierConfigs = [
            { name: "Tier 1", headerClass: "t1-header", cardClass: "t1-card", icon: "ğŸ¥‡" },
            { name: "Tier 2", headerClass: "t2-header", cardClass: "t2-card", icon: "ğŸ¥ˆ" },
            { name: "Tier 3", headerClass: "t3-header", cardClass: "t3-card", icon: "ğŸ¥‰" },
            { name: "Tier 4", headerClass: "t4-header", cardClass: "t4-card", icon: "" },
            { name: "Tier 5", headerClass: "t5-header", cardClass: "t5-card", icon: "" }
        ];

        const levelMap = {
            'H': { score: 3, label: 'H', color: '#ff4d4d' },
            'M': { score: 2, label: 'M', color: '#ffd700' },
            'L': { score: 1, label: 'L', color: '#4caf50' }
        };

        window.onload = function() {
            // é è¨­è¼‰å…¥ç¬¬ä¸€å€‹åˆ†é  'Sword'
            const defaultMode = 'Sword';
            const defaultBtn = document.querySelector(`.nav-item[onclick*="'${defaultMode}'"]`);
            if (defaultBtn) {
                switchTab(defaultBtn, defaultMode);
            }
        };

        function switchTab(element, sheetName) {
            // 1. UI æ›´æ–°
            if(element) {
                document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                element.classList.add('active');
            }
            
            // æ¸…ç©ºæœå°‹
            const searchInput = document.getElementById('searchInput');
            if(searchInput) searchInput.value = '';

            currentMode = sheetName;

            // 2. æª¢æŸ¥æ˜¯å¦å·²ç¶“æœ‰è³‡æ–™ (Cache)
            if (database[sheetName]) {
                renderBoard(sheetName);
            } else {
                // 3. æ²’æœ‰è³‡æ–™å‰‡å»æŠ“å–è©²åˆ†é 
                fetchData(sheetName);
            }
        }

        function fetchData(sheetName) {
            const board = document.getElementById('tierBoard');
            board.innerHTML = `<div class="loading-data"><span class="loading-spinner"></span>æ­£åœ¨è¼‰å…¥ ${sheetName} æ•¸æ“š...</div>`;

            // ä½¿ç”¨ sheetName ä½œç‚º URL çš„ä¸€éƒ¨åˆ†
            fetch(`https://opensheet.elk.sh/${spreadsheetId}/${sheetName}`)
                .then(res => {
                    if (!res.ok) throw new Error('Network response was not ok');
                    return res.json();
                })
                .then(rows => {
                    // å¦‚æœ rows æ˜¯ç©ºçš„æˆ–è€…æœ‰éŒ¯èª¤å±¬æ€§
                    if (!Array.isArray(rows)) {
                        throw new Error('Data format error or sheet not found');
                    }
                    processData(rows, sheetName);
                    renderBoard(sheetName);
                })
                .catch(err => {
                    console.error("è®€å–å¤±æ•—:", err);
                    board.innerHTML = `<div class="no-data">ç„¡æ³•è®€å–åˆ†é  "${sheetName}"ã€‚<br><small>è«‹ç¢ºèª Google Sheet ä¸­æ˜¯å¦æœ‰æ­¤åˆ†é åç¨±ã€‚</small></div>`;
                });
        }

        function processData(rows, sheetName) {
            // åˆå§‹åŒ–è©²æ¨¡å¼çš„è³‡æ–™çµæ§‹
            if (!database[sheetName]) database[sheetName] = {};

            rows.forEach(row => {
                // ä¸å†æª¢æŸ¥ row.categoryï¼Œç›´æ¥å°‡è³‡æ–™æ­¸é¡åˆ°ç›®å‰çš„ sheetName
                if (!row.tier || !row.player) return; // åŸºæœ¬é˜²å‘†

                const tierName = `Tier ${row.tier}`;
                const playerObj = {
                    name: row.player,
                    level: row.level ? row.level.toUpperCase() : 'M'
                };

                if (!database[sheetName][tierName]) {
                    database[sheetName][tierName] = [];
                }

                database[sheetName][tierName].push(playerObj);
            });

            // æ’åº (æ ¹æ“š H/M/L)
            for (const tier in database[sheetName]) {
                database[sheetName][tier].sort((a, b) => {
                    const scoreA = levelMap[a.level]?.score || 0;
                    const scoreB = levelMap[b.level]?.score || 0;
                    return scoreB - scoreA;
                });
            }
        }

        function renderBoard(mode) {
            const board = document.getElementById('tierBoard');
            board.innerHTML = ''; 

            const currentData = database[mode];

            if (!currentData || Object.keys(currentData).length === 0) {
                board.innerHTML = '<div class="no-data">æ­¤æ¨¡å¼æš«ç„¡æ•¸æ“š / No Data</div>';
                return;
            }

            tierConfigs.forEach(config => {
                const players = currentData[config.name] || [];
                const col = document.createElement('div');
                col.className = 'tier-column';

                const header = document.createElement('div');
                header.className = `tier-header ${config.headerClass}`;
                
                const iconHtml = config.icon ? `${config.icon} ` : '';
                header.innerHTML = `${iconHtml}${config.name}`;

                const list = document.createElement('div');
                list.className = 'player-list';

                players.forEach(p => {
                    const lvlInfo = levelMap[p.level] || levelMap['M'];
                    const card = document.createElement('div');
                    card.className = `player-card ${config.cardClass}`;
                    
                    card.innerHTML = `
                        <div style="display:flex; align-items:center; gap:8px;">
                            <span style="
                                background:${lvlInfo.color}; 
                                color:#000; 
                                font-size:0.75rem; 
                                font-weight:bold; 
                                padding:1px 5px; 
                                border-radius:4px;
                                min-width:18px;
                                text-align:center;
                            ">${lvlInfo.label}</span>
                            <span>${p.name}</span>
                        </div>
                        <span class="arrow-icon">Â»</span>
                    `;
                    list.appendChild(card);
                });

                col.appendChild(header);
                col.appendChild(list);
                board.appendChild(col);
            });
            
            // é‡æ–°æ‡‰ç”¨ç¯©é¸å™¨ (å¦‚æœåˆ‡æ› tab å‰æœ‰è¼¸å…¥æ–‡å­—)
            filterPlayers();
        }

        function filterPlayers() {
            const input = document.getElementById('searchInput').value.toLowerCase();
            const cards = document.querySelectorAll('.player-card');

            cards.forEach(card => {
                const text = card.innerText.toLowerCase();
                if (text.includes(input)) {
                    card.style.display = "flex";
                } else {
                    card.style.display = "none";
                }
            });
        }
    </script>
</body>
</html>
